<!DOCTYPE html>
<html lang="pt-br">
	<head>
		<meta charset="UTF-8" />
		<title>Produtos</title>
		<style>
			body {
				font-family: Arial;
				margin: 0;
			}
			.card {
				border: 1px solid #ccc;
				padding: 12px;
				margin: 8px 0;
				border-radius: 6px;
			}
			.card button {
				margin-left: 8px;
			}
			form {
				margin-bottom: 24px;
			}
			.container { margin: 32px; }
            nav {
            background: #111;
            padding: 12px 24px;
        }
        nav a {
            color: #fff;
            text-decoration: none;
            margin-right: 24px;
            font-weight: bold;
            font-size: 16px;
        }
        nav a:hover {
            text-decoration: underline;
        }
		</style>
	</head>
	<body>
		<nav>
			<a href="/">Início</a>
			<a href="/produtos">Produtos</a>
			<a href="/usuarios">Usuários</a>
			<a href="/pedidos">Pedidos</a>
		</nav>
		<div class="container">
			<h1>Cadastro de Produto</h1>
			<form id="form-produto">
				<input type="hidden" id="produto-id" />
				<input type="text" id="nome" placeholder="Nome" required />
				<input type="number" id="preco" placeholder="Preço" step="0.01" required />
				<button type="submit">Salvar</button>
			</form>
			<h2>Produtos cadastrados</h2>
			<div id="produtos"></div>
		</div>
		<script>
			async function carregarProdutos() {
				const resp = await fetch('/produtos', { headers: { Accept: 'application/json' } });
				const produtos = await resp.json();
				const div = document.getElementById('produtos');
				div.innerHTML = '';
				produtos.forEach((prod) => {
					const card = document.createElement('div');
					card.className = 'card';
					card.innerHTML = `
                    <b>${prod.nome}</b> - R$ ${prod.preco}
                    <button onclick="editar('${prod._id}', '${prod.nome}', ${prod.preco})">Editar</button>
                    <button onclick="excluir('${prod._id}')">Excluir</button>
                `;
					div.appendChild(card);
				});
			}
			carregarProdutos();

			document.getElementById('form-produto').onsubmit = async function (e) {
				e.preventDefault();
				const id = document.getElementById('produto-id').value;
				const nome = document.getElementById('nome').value;
				const preco = parseFloat(document.getElementById('preco').value);
				const metodo = id ? 'PUT' : 'POST';
				const url = id ? `/produtos/${id}` : '/produtos';
				const resp = await fetch(url, {
					method: metodo,
					headers: { 'Content-Type': 'application/json' },
					body: JSON.stringify({ nome, preco }),
				});
				const resultado = await resp.json();
				if (resp.ok) {
					console.log('Produto cadastrado:', resultado);
				} else {
					console.error('Erro ao cadastrar produto:', resultado);
				}
				document.getElementById('form-produto').reset();
				document.getElementById('produto-id').value = '';
				carregarProdutos();
			};

			window.editar = function (id, nome, preco) {
				document.getElementById('produto-id').value = id;
				document.getElementById('nome').value = nome;
				document.getElementById('preco').value = preco;
			};

			window.excluir = async function (id) {
				await fetch(`/produtos/${id}`, { method: 'DELETE' });
				carregarProdutos();
			};
		</script>
	</body>
</html>
